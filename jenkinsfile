pipeline {
   agent { label 'jenkins-agent' }
   tools {
           jdk 'java17'
           maven 'Maven3'
    }
   stages {
     stage ( "cleanup workspace" ) {
       steps {
       cleanWs()
       } 
     }
     stage ( "checkout from SCM" ) {
      steps {
       git branch: 'main', credentialsId: 'github', url: 'https://github.com/hariharanbharatha/feb02practice'
       }
     }
      stage ("Build application"){
       steps {
      sh "mvn clean package"
       }
     }
     stage ("test application"){
      steps {
        sh "mvn test"
        }
      }
   stage("SonarQube Analysis"){
      steps {
	      script {
		    withSonarQubeEnv(credentialsId: 'jenkins-sonarqube-token') { 
             sh "mvn sonar:sonar"
		        }
            }
         }
       }
stage("Quality Gate"){
           steps {
               script {
                    waitForQualityGate abortPipeline: false, credentialsId: 'jenkins-sonarqube-token'
                }	
            }

        }
     }
 }
